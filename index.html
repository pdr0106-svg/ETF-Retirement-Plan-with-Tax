
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETF 은퇴 자산 시뮬레이터</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        
        /* 입력 필드 스타일 */
        .input-group { @apply flex flex-col gap-1; }
        .input-label { @apply text-[11px] font-bold text-slate-500 uppercase tracking-wide; }
        .input-field { @apply w-full p-2 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white; }
        
        /* 숫자 입력창 화살표 제거 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        .card { @apply bg-white p-4 rounded-2xl shadow-sm border border-slate-100; }
        
        /* 모바일 탭 스타일 */
        .tab-btn { @apply flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent transition-all; }
        .tab-btn.active { @apply text-blue-600 border-blue-600; }

        /* 커스텀 스크롤바 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { AreaChart, Area, BarChart, Bar, LineChart, Line, ComposedChart, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        const formatMoney = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(val);

        const App = () => {
            // =================================================================================
            // 1. 상태 관리
            // =================================================================================
            const startYear = 2026;
            const endYear = 2057;
            const endMonth = 6;

            // VOO
            const [vooInit, setVooInit] = useState(332.76); // 사용자 언급 값으로 수정
            const [vooRate, setVooRate] = useState(7.0);
            const [vooMonthly, setVooMonthly] = useState(140);
            const [vooIncrease, setVooIncrease] = useState(35);
            const [vooYield, setVooYield] = useState(1.5);

            // QQQM
            const [qqqmInit, setQqqmInit] = useState(59.97);
            const [qqqmRate, setQqqmRate] = useState(9.0);
            const [qqqmMonthly, setQqqmMonthly] = useState(60);
            const [qqqmIncrease, setQqqmIncrease] = useState(15);
            const [qqqmYield, setQqqmYield] = useState(0.6);

            // VTI
            const [vtiInit, setVtiInit] = useState(175.36);
            const [vtiRate, setVtiRate] = useState(7.0);
            const [vtiYield, setVtiYield] = useState(1.5);

            // Tax
            const [taxFed, setTaxFed] = useState(15.0);
            const [taxState, setTaxState] = useState(6.0);

            // Extra
            const [extras, setExtras] = useState([]);
            
            // UI
            const [activeTab, setActiveTab] = useState('summary');
            const [isExtraModalOpen, setIsExtraModalOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false); // 모바일 설정 패널 토글
            const [newExtra, setNewExtra] = useState({ year: 2026, type: 'voo', amount: 0 });

            // =================================================================================
            // 2. 계산 로직 (수정됨)
            // =================================================================================
            const result = useMemo(() => {
                const data = [];
                let currentVoo = vooInit;
                let currentQqqm = qqqmInit;
                let currentVti = vtiInit;

                let principalVoo = vooInit;
                let principalQqqm = qqqmInit;
                let principalVti = vtiInit;

                let totalDivVoo = 0;
                let totalDivQqqm = 0;
                let totalDivVti = 0;

                const totalMonths = (endYear - startYear) * 12 + endMonth;
                
                for (let m = 0; m <= totalMonths; m++) {
                    const currentYear = startYear + Math.floor(m / 12);
                    const currentMonth = (m % 12) + 1;
                    const yearIndex = Math.floor(m / 12);

                    // 월 적립금 계산 (해당 연도 증액분 반영)
                    const monthlyInputVoo = vooMonthly + (yearIndex * vooIncrease);
                    const monthlyInputQqqm = qqqmMonthly + (yearIndex * qqqmIncrease);
                    
                    // 추가 납입금 계산 (1월에만)
                    let extraVoo = 0, extraQqqm = 0, extraVti = 0;
                    if (currentMonth === 1) {
                        extras.forEach(ex => {
                            if (ex.year === currentYear) {
                                if (ex.type === 'voo') extraVoo += ex.amount;
                                if (ex.type === 'qqqm') extraQqqm += ex.amount;
                                if (ex.type === 'vti') extraVti += ex.amount;
                            }
                        });
                    }

                    // [수정된 로직] 첫 달(m=0)부터 월 적립금을 더해줍니다.
                    // 기존 로직에서는 m > 0 일 때만 monthlyInput을 더해서 첫달이 누락되었습니다.
                    currentVoo += monthlyInputVoo + extraVoo;
                    principalVoo += monthlyInputVoo + extraVoo;
                    
                    currentQqqm += monthlyInputQqqm + extraQqqm;
                    principalQqqm += monthlyInputQqqm + extraQqqm;
                    
                    // VTI는 월 적립 설정이 없으므로 추가 납입만 더함
                    currentVti += extraVti;
                    principalVti += extraVti;

                    // 월 복리 수익 적용
                    currentVoo *= (1 + vooRate / 100 / 12);
                    currentQqqm *= (1 + qqqmRate / 100 / 12);
                    currentVti *= (1 + vtiRate / 100 / 12);

                    // 배당금 누적
                    totalDivVoo += currentVoo * (vooYield / 100 / 12);
                    totalDivQqqm += currentQqqm * (qqqmYield / 100 / 12);
                    totalDivVti += currentVti * (vtiYield / 100 / 12);

                    // 연말(12월) 또는 시뮬레이션 종료 시 데이터 기록
                    if (currentMonth === 12 || m === totalMonths) {
                        const totalAssets = currentVoo + currentQqqm + currentVti;
                        const totalPrincipal = principalVoo + principalQqqm + principalVti;
                        const totalGain = totalAssets - totalPrincipal;
                        const annualDividend = totalDivVoo + totalDivQqqm + totalDivVti;
                        const fedTax = annualDividend * (taxFed / 100);
                        const stateTax = annualDividend * (taxState / 100);

                        data.push({
                            year: currentYear,
                            month: currentMonth,
                            voo: Math.round(currentVoo),
                            qqqm: Math.round(currentQqqm),
                            vti: Math.round(currentVti),
                            total: Math.round(totalAssets),
                            principal: Math.round(totalPrincipal),
                            gain: Math.round(totalGain),
                            dividend: Math.round(annualDividend),
                            fedTax: Math.round(fedTax),
                            stateTax: Math.round(stateTax),
                            totalTax: Math.round(fedTax + stateTax),
                            vooPrincipal: Math.round(principalVoo),
                            qqqmPrincipal: Math.round(principalQqqm),
                            vtiPrincipal: Math.round(principalVti),
                        });
                        // 배당금 리셋
                        totalDivVoo = 0; totalDivQqqm = 0; totalDivVti = 0;
                    }
                }
                return data;
            }, [vooInit, vooRate, vooMonthly, vooIncrease, vooYield, qqqmInit, qqqmRate, qqqmMonthly, qqqmIncrease, qqqmYield, vtiInit, vtiRate, vtiYield, taxFed, taxState, extras]);

            const finalData = result[result.length - 1] || {};
            const finalVooGain = (finalData.voo || 0) - (finalData.vooPrincipal || 0);
            const finalQqqmGain = (finalData.qqqm || 0) - (finalData.qqqmPrincipal || 0);
            const finalVtiGain = (finalData.vti || 0) - (finalData.vtiPrincipal || 0);

            const addExtra = () => {
                if (newExtra.amount > 0) {
                    setExtras([...extras, { ...newExtra, id: Date.now() }]);
                    setNewExtra({ ...newExtra, amount: 0 });
                    setIsExtraModalOpen(false);
                }
            };
            const removeExtra = (id) => setExtras(extras.filter(e => e.id !== id));

            // 모바일인지 감지하여 초기 상태 설정 (필요시)
            useEffect(() => {
                const handleResize = () => {
                    if (window.innerWidth >= 1024) setIsSettingsOpen(true);
                    else setIsSettingsOpen(false);
                };
                window.addEventListener('resize', handleResize);
                handleResize(); // init
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            return (
                <div className="min-h-screen flex flex-col max-w-7xl mx-auto md:p-6 pb-20 md:pb-6">
                    {/* Header */}
                    <div className="bg-white p-4 sticky top-0 z-20 shadow-sm md:shadow-none md:static flex justify-between items-center border-b md:border-none border-slate-100">
                        <div>
                            <h1 className="text-lg md:text-2xl font-bold text-slate-800 flex items-center gap-2">
                                <i className="ph-fill ph-chart-polar text-blue-600"></i>
                                ETF 자산 시뮬레이터
                            </h1>
                            <p className="text-xs text-slate-500 mt-0.5">2026 ~ 2057 (은퇴 플랜)</p>
                        </div>
                        {/* Mobile Settings Toggle */}
                        <button 
                            onClick={() => setIsSettingsOpen(!isSettingsOpen)}
                            className="lg:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-full transition-colors"
                        >
                            <i className={`ph-fill ${isSettingsOpen ? 'ph-x' : 'ph-sliders-horizontal'} text-xl`}></i>
                        </button>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-6 p-4 md:p-0">
                        
                        {/* Settings Sidebar / Accordion */}
                        <div className={`lg:w-80 space-y-4 ${isSettingsOpen ? 'block' : 'hidden lg:block'}`}>
                            
                            {/* VOO Input */}
                            <div className="card border-l-4 border-l-blue-500">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center justify-between">
                                    <span>VOO 설정</span>
                                    <span className="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-full font-extrabold">S&P 500</span>
                                </h3>
                                <div className="space-y-3">
                                    <div className="input-group">
                                        <label className="input-label">초기 자금 ($)</label>
                                        <input type="number" value={vooInit} onChange={e => setVooInit(Number(e.target.value))} className="input-field" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="input-group">
                                            <label className="input-label">수익률 (%)</label>
                                            <input type="number" value={vooRate} onChange={e => setVooRate(Number(e.target.value))} className="input-field" />
                                        </div>
                                        <div className="input-group">
                                            <label className="input-label">월 적립 ($)</label>
                                            <input type="number" value={vooMonthly} onChange={e => setVooMonthly(Number(e.target.value))} className="input-field" />
                                        </div>
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">매년 월 적립 증액분 ($)</label>
                                        <input type="number" value={vooIncrease} onChange={e => setVooIncrease(Number(e.target.value))} className="input-field" />
                                    </div>
                                </div>
                            </div>

                            {/* QQQM Input */}
                            <div className="card border-l-4 border-l-purple-500">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center justify-between">
                                    <span>QQQM 설정</span>
                                    <span className="text-[10px] bg-purple-50 text-purple-600 px-2 py-1 rounded-full font-extrabold">Nasdaq</span>
                                </h3>
                                <div className="space-y-3">
                                    <div className="input-group">
                                        <label className="input-label">초기 자금 ($)</label>
                                        <input type="number" value={qqqmInit} onChange={e => setQqqmInit(Number(e.target.value))} className="input-field" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="input-group">
                                            <label className="input-label">수익률 (%)</label>
                                            <input type="number" value={qqqmRate} onChange={e => setQqqmRate(Number(e.target.value))} className="input-field" />
                                        </div>
                                        <div className="input-group">
                                            <label className="input-label">월 적립 ($)</label>
                                            <input type="number" value={qqqmMonthly} onChange={e => setQqqmMonthly(Number(e.target.value))} className="input-field" />
                                        </div>
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">매년 월 적립 증액분 ($)</label>
                                        <input type="number" value={qqqmIncrease} onChange={e => setQqqmIncrease(Number(e.target.value))} className="input-field" />
                                    </div>
                                </div>
                            </div>

                            {/* VTI Input */}
                            <div className="card border-l-4 border-l-green-500">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center justify-between">
                                    <span>VTI 설정</span>
                                    <span className="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full font-extrabold">Total Mkt</span>
                                </h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="input-group">
                                        <label className="input-label">현재 평가액 ($)</label>
                                        <input type="number" value={vtiInit} onChange={e => setVtiInit(Number(e.target.value))} className="input-field" />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">수익률 (%)</label>
                                        <input type="number" value={vtiRate} onChange={e => setVtiRate(Number(e.target.value))} className="input-field" />
                                    </div>
                                </div>
                            </div>
                            
                            <button 
                                onClick={() => setIsExtraModalOpen(true)}
                                className="w-full py-3 bg-slate-800 text-white rounded-xl text-sm font-bold hover:bg-slate-700 transition flex items-center justify-center gap-2 shadow-lg shadow-slate-200 active:scale-95"
                            >
                                <i className="ph-fill ph-coins text-lg"></i>
                                추가 납입 설정 ({extras.length})
                            </button>
                            
                            {/* 모바일에서 설정 닫기 버튼 */}
                            <button 
                                onClick={() => setIsSettingsOpen(false)}
                                className="lg:hidden w-full py-3 bg-slate-200 text-slate-600 rounded-xl text-sm font-bold mt-2"
                            >
                                설정 닫기
                            </button>

                        </div>

                        {/* Main Content */}
                        <div className="flex-1 flex flex-col gap-4">
                            
                            {/* Summary Cards (Always Visible) */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div className="col-span-2 md:col-span-1 bg-gradient-to-br from-slate-800 to-slate-900 p-4 rounded-2xl shadow-lg text-white">
                                    <div className="text-[10px] text-slate-300 font-medium mb-1 opacity-80">총 예상 자산 (2057)</div>
                                    <div className="text-2xl font-bold tracking-tight">{formatMoney(finalData.total || 0)}</div>
                                    <div className="mt-2 pt-2 border-t border-white/10 flex justify-between text-[10px] text-slate-300">
                                        <span>수익</span>
                                        <span className="text-amber-400 font-bold">+{formatMoney(finalData.gain || 0)}</span>
                                    </div>
                                </div>
                                <div className="bg-white p-3 rounded-2xl border border-blue-100 shadow-sm">
                                    <div className="text-[10px] text-blue-500 font-bold mb-1">VOO</div>
                                    <div className="text-lg font-bold text-slate-800">{formatMoney(finalData.voo || 0)}</div>
                                    <div className="text-[10px] text-slate-400 mt-1">+{formatMoney(finalVooGain)}</div>
                                </div>
                                <div className="bg-white p-3 rounded-2xl border border-purple-100 shadow-sm">
                                    <div className="text-[10px] text-purple-500 font-bold mb-1">QQQM</div>
                                    <div className="text-lg font-bold text-slate-800">{formatMoney(finalData.qqqm || 0)}</div>
                                    <div className="text-[10px] text-slate-400 mt-1">+{formatMoney(finalQqqmGain)}</div>
                                </div>
                                <div className="bg-white p-3 rounded-2xl border border-green-100 shadow-sm">
                                    <div className="text-[10px] text-green-500 font-bold mb-1">VTI</div>
                                    <div className="text-lg font-bold text-slate-800">{formatMoney(finalData.vti || 0)}</div>
                                    <div className="text-[10px] text-slate-400 mt-1">+{formatMoney(finalVtiGain)}</div>
                                </div>
                            </div>

                            {/* Tabs */}
                            <div className="flex border-b border-slate-200 bg-white sticky top-0 md:static z-10 md:rounded-t-xl">
                                {[
                                    { id: 'summary', label: '차트', icon: 'ph-chart-line-up' },
                                    { id: 'detail', label: '상세표', icon: 'ph-table' },
                                    { id: 'tax', label: '세금', icon: 'ph-receipt' },
                                ].map(tab => (
                                    <button 
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`tab-btn flex items-center justify-center gap-1.5 ${activeTab === tab.id ? 'active' : ''}`}
                                    >
                                        <i className={`ph ${tab.icon} text-lg`}></i>
                                        <span>{tab.label}</span>
                                    </button>
                                ))}
                            </div>

                            {/* Content Area */}
                            <div className="flex-1 bg-white md:rounded-b-xl md:rounded-tr-xl shadow-sm border-x border-b border-slate-200 p-4 min-h-[400px]">
                                
                                {activeTab === 'summary' && (
                                    <div className="space-y-8">
                                        <div>
                                            <h3 className="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
                                                <i className="ph-fill ph-trend-up text-blue-500"></i> 자산 성장 추이
                                            </h3>
                                            <div className="h-[250px] md:h-[350px] -ml-2">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={result} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
                                                        <defs>
                                                            <linearGradient id="colorVoo" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                                                                <stop offset="95%" stopColor="#3b82f6" stopOpacity={0.1}/>
                                                            </linearGradient>
                                                            <linearGradient id="colorQqqm" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor="#a855f7" stopOpacity={0.8}/>
                                                                <stop offset="95%" stopColor="#a855f7" stopOpacity={0.1}/>
                                                            </linearGradient>
                                                            <linearGradient id="colorVti" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor="#22c55e" stopOpacity={0.8}/>
                                                                <stop offset="95%" stopColor="#22c55e" stopOpacity={0.1}/>
                                                            </linearGradient>
                                                        </defs>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                        <XAxis dataKey="year" tick={{fontSize:10, fill:'#64748b'}} minTickGap={30} tickLine={false} axisLine={false} />
                                                        <YAxis tickFormatter={(val) => `$${val/1000}k`} tick={{fontSize:10, fill:'#64748b'}} tickLine={false} axisLine={false} />
                                                        <Tooltip 
                                                            formatter={(val) => formatMoney(val)} 
                                                            contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}}
                                                        />
                                                        <Legend wrapperStyle={{fontSize: '12px', paddingTop: '10px'}} />
                                                        <Area type="monotone" dataKey="voo" stackId="1" stroke="#3b82f6" fill="url(#colorVoo)" name="VOO" />
                                                        <Area type="monotone" dataKey="qqqm" stackId="1" stroke="#a855f7" fill="url(#colorQqqm)" name="QQQM" />
                                                        <Area type="monotone" dataKey="vti" stackId="1" stroke="#22c55e" fill="url(#colorVti)" name="VTI" />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>

                                        <div className="pt-6 border-t border-slate-100">
                                            <h3 className="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
                                                <i className="ph-fill ph-piggy-bank text-amber-500"></i> 원금 vs 수익
                                            </h3>
                                            <div className="h-[250px] md:h-[300px] -ml-2">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={result}>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                        <XAxis dataKey="year" tick={{fontSize:10, fill:'#64748b'}} minTickGap={30} tickLine={false} axisLine={false} />
                                                        <YAxis tickFormatter={(val) => `$${val/1000}k`} tick={{fontSize:10, fill:'#64748b'}} tickLine={false} axisLine={false} />
                                                        <Tooltip formatter={(val) => formatMoney(val)} contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} />
                                                        <Legend wrapperStyle={{fontSize: '12px', paddingTop: '10px'}} />
                                                        <Area type="monotone" dataKey="principal" stackId="1" stroke="#64748b" fill="#94a3b8" name="원금" />
                                                        <Area type="monotone" dataKey="gain" stackId="1" stroke="#f59e0b" fill="#fbbf24" name="수익" />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'detail' && (
                                    <div className="overflow-x-auto -mx-4 md:mx-0">
                                        <div className="min-w-[600px] px-4 md:px-0">
                                            <table className="w-full text-xs text-right">
                                                <thead className="bg-slate-50 border-y border-slate-100 text-slate-500">
                                                    <tr>
                                                        <th className="px-3 py-3 text-left">연도</th>
                                                        <th className="px-3 py-3 text-blue-600">VOO</th>
                                                        <th className="px-3 py-3 text-purple-600">QQQM</th>
                                                        <th className="px-3 py-3 text-green-600">VTI</th>
                                                        <th className="px-3 py-3 font-bold text-slate-900 border-l border-slate-200">총 자산</th>
                                                        <th className="px-3 py-3 text-slate-500">원금</th>
                                                        <th className="px-3 py-3 text-amber-600">수익</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {result.map((row, idx) => (
                                                        <tr key={idx} className="hover:bg-slate-50">
                                                            <td className="px-3 py-3 text-left font-medium text-slate-700">
                                                                {row.year}
                                                                {row.month === 6 && row.year === 2057 && <span className="ml-1 text-[9px] bg-red-100 text-red-600 px-1 py-0.5 rounded">END</span>}
                                                            </td>
                                                            <td className="px-3 py-3">{formatMoney(row.voo)}</td>
                                                            <td className="px-3 py-3">{formatMoney(row.qqqm)}</td>
                                                            <td className="px-3 py-3">{formatMoney(row.vti)}</td>
                                                            <td className="px-3 py-3 font-bold text-slate-900 border-l border-slate-200 bg-slate-50/30">{formatMoney(row.total)}</td>
                                                            <td className="px-3 py-3 text-slate-400">{formatMoney(row.principal)}</td>
                                                            <td className="px-3 py-3 text-amber-600 font-medium">{formatMoney(row.gain)}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'tax' && (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="p-4 bg-red-50 rounded-2xl border border-red-100">
                                                <div className="text-xs text-red-800 font-bold uppercase mb-3 flex items-center gap-2">
                                                    <i className="ph-fill ph-percent"></i> 세율 설정
                                                </div>
                                                <div className="space-y-3">
                                                    <div className="flex justify-between items-center text-sm">
                                                        <span>연방세 (Federal)</span>
                                                        <div className="flex items-center gap-1">
                                                            <input type="number" value={taxFed} onChange={e=>setTaxFed(Number(e.target.value))} className="w-16 text-right p-1.5 border border-red-200 rounded bg-white" />
                                                            <span className="text-slate-500">%</span>
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-between items-center text-sm">
                                                        <span>주세 (State)</span>
                                                        <div className="flex items-center gap-1">
                                                            <input type="number" value={taxState} onChange={e=>setTaxState(Number(e.target.value))} className="w-16 text-right p-1.5 border border-red-200 rounded bg-white" />
                                                            <span className="text-slate-500">%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="p-4 bg-yellow-50 rounded-2xl border border-yellow-100">
                                                <div className="text-xs text-yellow-800 font-bold uppercase mb-3 flex items-center gap-2">
                                                    <i className="ph-fill ph-plant"></i> 배당률 (Yield)
                                                </div>
                                                <div className="grid grid-cols-3 gap-2">
                                                    <div className="text-center">
                                                        <span className="text-[10px] text-slate-500 block mb-1">VOO</span>
                                                        <input type="number" value={vooYield} onChange={e=>setVooYield(Number(e.target.value))} className="w-full text-center p-1.5 text-sm border border-yellow-200 rounded bg-white" />
                                                    </div>
                                                    <div className="text-center">
                                                        <span className="text-[10px] text-slate-500 block mb-1">QQQM</span>
                                                        <input type="number" value={qqqmYield} onChange={e=>setQqqmYield(Number(e.target.value))} className="w-full text-center p-1.5 text-sm border border-yellow-200 rounded bg-white" />
                                                    </div>
                                                    <div className="text-center">
                                                        <span className="text-[10px] text-slate-500 block mb-1">VTI</span>
                                                        <input type="number" value={vtiYield} onChange={e=>setVtiYield(Number(e.target.value))} className="w-full text-center p-1.5 text-sm border border-yellow-200 rounded bg-white" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-slate-900 text-white p-5 rounded-2xl text-center shadow-lg">
                                            <div className="text-xs text-slate-400 mb-1">2057년 예상 연간 세금 총액</div>
                                            <div className="text-3xl font-bold">{formatMoney(finalData.totalTax || 0)}</div>
                                            <div className="text-[11px] text-slate-500 mt-2 bg-slate-800 inline-block px-3 py-1 rounded-full">
                                                Fed: {formatMoney(finalData.fedTax || 0)} + State: {formatMoney(finalData.stateTax || 0)}
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-sm font-bold text-slate-700 mb-4">연도별 세금 추이</h3>
                                            <div className="h-[250px] -ml-2">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <ComposedChart data={result}>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                        <XAxis dataKey="year" tick={{fontSize:10, fill:'#64748b'}} axisLine={false} tickLine={false} />
                                                        <YAxis tickFormatter={(val) => `$${val}`} tick={{fontSize:10, fill:'#64748b'}} axisLine={false} tickLine={false} />
                                                        <Tooltip formatter={(val) => formatMoney(val)} contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} />
                                                        <Bar dataKey="dividend" name="배당금" fill="#10b981" barSize={12} radius={[4, 4, 0, 0]} />
                                                        <Line type="monotone" dataKey="totalTax" name="세금 합계" stroke="#ef4444" strokeWidth={2} dot={false} />
                                                    </ComposedChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Extra Contribution Modal */}
                    {isExtraModalOpen && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end md:items-center justify-center z-50 p-0 md:p-4">
                            <div className="bg-white rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-slide-up md:animate-fade-in max-h-[90vh] flex flex-col">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-bold text-slate-800">추가 납입 설정</h3>
                                    <button onClick={() => setIsExtraModalOpen(false)} className="text-slate-400 hover:text-slate-600">
                                        <i className="ph-fill ph-x-circle text-2xl"></i>
                                    </button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto min-h-0 mb-4">
                                    {extras.length === 0 ? (
                                        <div className="text-center py-8 bg-slate-50 rounded-xl border border-dashed border-slate-200">
                                            <i className="ph ph-piggy-bank text-3xl text-slate-300 mb-2"></i>
                                            <p className="text-xs text-slate-400">등록된 추가 납입이 없습니다.</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-2">
                                            {extras.map(ex => (
                                                <div key={ex.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                                                    <div className="flex items-center gap-3">
                                                        <span className="font-bold text-slate-700">{ex.year}년</span>
                                                        <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${ex.type === 'voo' ? 'bg-blue-100 text-blue-700' : ex.type === 'qqqm' ? 'bg-purple-100 text-purple-700' : 'bg-green-100 text-green-700'}`}>
                                                            {ex.type.toUpperCase()}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <span className="font-bold text-slate-800">{formatMoney(ex.amount)}</span>
                                                        <button onClick={() => removeExtra(ex.id)} className="text-red-400 hover:text-red-600 p-1">
                                                            <i className="ph-fill ph-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="pt-4 border-t border-slate-100 bg-white space-y-3">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="input-group">
                                            <label className="input-label">연도</label>
                                            <input type="number" min="2026" max="2057" value={newExtra.year} onChange={e => setNewExtra({...newExtra, year: Number(e.target.value)})} className="input-field bg-slate-50" />
                                        </div>
                                        <div className="input-group">
                                            <label className="input-label">종목</label>
                                            <select value={newExtra.type} onChange={e => setNewExtra({...newExtra, type: e.target.value})} className="input-field bg-slate-50 h-[42px]">
                                                <option value="voo">VOO</option>
                                                <option value="qqqm">QQQM</option>
                                                <option value="vti">VTI</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">금액 ($)</label>
                                        <input type="number" value={newExtra.amount} onChange={e => setNewExtra({...newExtra, amount: Number(e.target.value)})} className="input-field bg-slate-50 text-lg font-bold text-blue-600" placeholder="0" />
                                    </div>
                                    <button onClick={addExtra} className="w-full py-3.5 bg-blue-600 text-white rounded-xl text-base font-bold hover:bg-blue-700 active:bg-blue-800 transition shadow-lg shadow-blue-200">
                                        추가하기
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

